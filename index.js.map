{"version":3,"file":"index.js","sources":["../lib/index.js"],"sourcesContent":["import React, { Component } from 'react';\n\nconst toolbarRender = (zoom, onZoom, onReset, minZoom = 10, maxZoom = 200) => (\n  <div>\n    <div onClick={onReset}>复位</div>\n    <div\n      onClick={\n        zoom > minZoom ? () => onZoom(Math.ceil(zoom / 10) * 10 - 10) : null\n      }\n    >\n      -\n    </div>\n    <div>{zoom}%</div>\n    <div\n      onClick={\n        zoom < maxZoom ? () => onZoom(Math.floor(zoom / 10) * 10 + 10) : null\n      }\n    >\n      +\n    </div>\n  </div>\n);\n\nclass Zoom extends Component {\n  constructor(props) {\n    super(props);\n\n    this.state = {\n      zoom: 100,\n      isMove: false,\n      top: 0,\n      left: 0,\n      oldTop: 0, // 按下时的定位top\n      oldLeft: 0, // 按下时的定位left\n      oldX: 0, // 按下时的偏移值x\n      oldY: 0 //按下时的偏移值y\n    };\n\n    this.container = null;\n    this.content = null;\n    this.onContainerChange = ref => (this.container = ref);\n    this.onContentChange = ref => (this.content = ref);\n\n    this.preventDefault = e => e.preventDefault();\n    this.onZoom = zoom => this.setState({ zoom });\n    this.onMouseUp = () => this.setState({ isMove: false });\n\n    this.getContainerSize = this.getContainerSize.bind(this);\n    this.getContentSize = this.getContentSize.bind(this);\n    this.onReset = this.onReset.bind(this);\n    this.onMouseDownHandler = this.onMouseDownHandler.bind(this);\n    this.onMouseMoveHandler = this.onMouseMoveHandler.bind(this);\n    this.onWheelHandler = this.onWheelHandler.bind(this);\n  }\n\n  componentDidMount() {\n    // 本组件的滚轮相关手势和浏览器触摸板双指左滑返回上一页冲突，解决办法就是阻止浏览器的默认行为\n    this.container.addEventListener('wheel', this.onWheelHandler, {\n      passive: false\n    });\n    this.onReset();\n  }\n\n  Unmounting() {\n    this.container.removeEventListener('wheel', this.onWheelHandler, {\n      passive: false\n    });\n  }\n\n  // 获取画布大小\n  getContainerSize() {\n    if (this.container) {\n      return {\n        containerWidth: this.container.offsetWidth,\n        containerHeight: this.container.offsetHeight\n      };\n    }\n    return { containerWidth: 0, containerHeight: 0 };\n  }\n\n  // 获取内容大小\n  getContentSize() {\n    if (this.content) {\n      return {\n        contentWidth: this.content.offsetWidth,\n        contentHeight: this.content.offsetHeight\n      };\n    }\n    return { contentWidth: 0, contentHeight: 0 };\n  }\n\n  // 设置可缩放树图位置到画布中心\n  onReset() {\n    const { padding } = this.props;\n    const { containerWidth, containerHeight } = this.getContainerSize();\n    const { contentWidth, contentHeight } = this.getContentSize();\n\n    const heightZoom = Math.min(\n      Math.floor(((containerHeight - 2 * padding) / contentHeight) * 100),\n      100\n    );\n    const widthZoom = Math.min(\n      Math.floor((containerWidth / contentWidth) * 100),\n      100\n    );\n\n    const zoom = Math.min(heightZoom, widthZoom);\n    this.setState({\n      top: padding - (((100 - zoom) / 100) * contentHeight) / 2,\n      left: (containerWidth - contentWidth) / 2,\n      zoom\n    });\n  }\n\n  onMouseDownHandler(event) {\n    const { top, left } = this.state;\n    this.setState({\n      isMove: true,\n      oldX: event.clientX,\n      oldY: event.clientY,\n      oldTop: top,\n      oldLeft: left\n    });\n  }\n\n  // 鼠标拖拽\n  onMouseMoveHandler(event) {\n    const { oldX, oldY, oldTop, oldLeft } = this.state;\n    const top = oldTop + event.clientY - oldY;\n    const left = oldLeft + event.clientX - oldX;\n    this.setState({ top, left });\n  }\n\n  // 鼠标滚轮\n  onWheelHandler(event) {\n    event.stopPropagation();\n    event.preventDefault();\n\n    const { minZoom, maxZoom } = this.props;\n    const newState = { ...this.state };\n\n    if (Number.isInteger(event.deltaY)) {\n      newState.top -= event.deltaY;\n      newState.left -= event.deltaX;\n    } else if (event.deltaY < 0) {\n      newState.zoom = Math.min(newState.zoom + 2, maxZoom);\n    } else {\n      newState.zoom = Math.max(newState.zoom - 2, minZoom);\n    }\n\n    this.setState(newState);\n  }\n\n  render() {\n    const { children, toolbarRender, minZoom, maxZoom } = this.props;\n    const { zoom, isMove, top, left } = this.state;\n\n    return (\n      <div\n        style={{\n          position: 'relative',\n          width: '100%',\n          height: '100%',\n          overflow: 'hidden'\n        }}\n        ref={this.onContainerChange}\n        onMouseDown={this.onMouseDownHandler}\n        onMouseMove={isMove ? this.onMouseMoveHandler : null}\n        onMouseUp={this.onMouseUp}\n        onMouseLeave={this.onMouseUp}\n      >\n        {toolbarRender(zoom, this.onZoom, this.onReset, minZoom, maxZoom)}\n        <div\n          ref={this.onContentChange}\n          style={{\n            position: 'absolute',\n            transform: `scale(${zoom / 100})`,\n            top: `${top}px`,\n            left: `${left}px`\n          }}\n        >\n          {children}\n        </div>\n      </div>\n    );\n  }\n}\n\nZoom.defaultProps = {\n  // 最小缩放比例 基数 100\n  minZoom: 10,\n  // 最大缩放比例 基数 100\n  maxZoom: 200,\n  // 顶部底部留白 xx px\n  padding: 20,\n  // 自定义toolbar\n  toolbarRender: toolbarRender\n};\n\nexport default Zoom;\n"],"names":["toolbarRender","zoom","onZoom","onReset","minZoom","maxZoom","React","Math","ceil","floor","Zoom","Component","constructor","props","state","isMove","top","left","oldTop","oldLeft","oldX","oldY","container","content","onContainerChange","ref","onContentChange","preventDefault","e","setState","onMouseUp","getContainerSize","bind","getContentSize","onMouseDownHandler","onMouseMoveHandler","onWheelHandler","componentDidMount","addEventListener","passive","Unmounting","removeEventListener","containerWidth","offsetWidth","containerHeight","offsetHeight","contentWidth","contentHeight","padding","heightZoom","min","widthZoom","event","clientX","clientY","stopPropagation","newState","Number","isInteger","deltaY","deltaX","max","render","children","position","width","height","overflow","transform","defaultProps"],"mappings":"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"}